# YARA-X Manager 项目运行说明

## 当前环境状态

- ✓ Python 可用
- ✗ Docker 未安装
- ✗ Redis 未安装  
- ✗ YARA-X Windows 版本未安装

## 推荐运行方案

由于当前 Windows 环境缺少必要组件，推荐以下方案：

### 方案 1：使用 WSL2（最简单）

```bash
# 在 WSL2 Ubuntu 中运行 Linux 版本
cd /mnt/d/大三上课程/恶意代码/实验报告/大作业/YARA-X\ Manager/YARA-X\ Manager/
bash run.sh
```

### 方案 2：手动安装 Windows 组件

#### 1. 安装 Redis（选择一个）
- **Memurai**（推荐）: https://www.memurai.com/get-memurai
- **Redis for Windows**: https://github.com/microsoftarchive/redis/releases

#### 2. 下载 YARA-X Windows 版本
```powershell
# 下载地址
https://github.com/VirusTotal/yara-x/releases/download/v1.9.0/yara-x-v1.9.0-x86_64-pc-windows-msvc.zip

# 解压后重命名为 yara-x.exe
```

#### 3. 运行启动脚本
```powershell
.\start.ps1
```

### 方案 3：完整手动启动

```powershell
# 1. 解压规则
Expand-Archive -Path my_rules.zip -DestinationPath . -Force

# 2. 启动 Redis（根据你的安装方式）
redis-server
# 或 memurai

# 3. 创建并激活虚拟环境
python -m venv .venv
.\.venv\Scripts\Activate.ps1

# 4. 安装依赖
pip install -r requirements.txt

# 5. 新开一个 PowerShell 窗口，启动 Celery
.\.venv\Scripts\Activate.ps1
celery -A app.celery_app.cel worker --loglevel=info --pool=solo

# 6. 新开一个 PowerShell 窗口，启动 API
.\.venv\Scripts\Activate.ps1  
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

## 功能测试（服务启动后）

访问 http://localhost:8000/docs 查看完整 API 文档

### 使用 Swagger UI 测试（最简单）
1. 打开 http://localhost:8000/docs
2. 点击接口 → "Try it out" → 填写参数 → "Execute"

### 使用 PowerShell 测试

```powershell
# 1. 查看所有规则
Invoke-RestMethod -Uri http://localhost:8000/rules/ -Method GET

# 2. 查看所有样本
Invoke-RestMethod -Uri http://localhost:8000/samples/ -Method GET

# 3. 上传样本（需要准备测试文件）
$form = @{
    files = Get-Item "test.exe"
}
Invoke-RestMethod -Uri http://localhost:8000/samples/upload -Method POST -Form $form

# 4. 启动扫描
Invoke-RestMethod -Uri http://localhost:8000/scans/start -Method POST

# 5. 查看扫描状态
Invoke-RestMethod -Uri http://localhost:8000/scans/status -Method GET
```

## 项目功能清单

### 1. 样本管理
- ✅ 批量上传恶意代码样本
- ✅ 查看所有已上传样本
- ✅ 查询单个样本信息
- ✅ 异步处理文件上传

### 2. 规则管理  
- ✅ 批量上传 YARA 规则
- ✅ 自动验证规则语法
- ✅ 启用/禁用规则
- ✅ 删除规则
- ✅ 预加载规则（from my_rules.zip）

### 3. 扫描任务
- ✅ 一键扫描所有样本
- ✅ 并行执行多个扫描任务
- ✅ 实时推送扫描状态（SSE）
- ✅ 查询扫描结果
- ✅ JSON 格式输出匹配结果

### 4. 高级特性
- ✅ 异步任务队列（Celery）
- ✅ 规则预编译（性能优化）
- ✅ 自动清理扫描后的样本
- ✅ RESTful API 设计
- ✅ Swagger 文档自动生成

## 下一步：分析 BinaryAlert

由于环境限制，我将继续分析 BinaryAlert 项目代码并完善实验报告。
