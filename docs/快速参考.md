# YARA-X Manager 快速参考

## 📚 文档索引

| 文档名称 | 用途 | 关键内容 |
|---------|------|---------|
| **实验报告.md** | 完整的实验报告 | BinaryAlert 调研、架构设计、对比分析 |
| **项目完成总结.md** | 任务完成情况总结 | 完成的工作、输出文件、学习收获 |
| **项目运行说明.md** | 运行指南 | 环境要求、功能清单、测试方法 |
| **Windows启动指南.md** | Windows 部署详解 | 安装步骤、常见问题、手动启动 |
| **run.ps1** | PowerShell 启动脚本 | 完整版自动化脚本 |
| **start.ps1** | 简化启动脚本 | 自动下载 YARA-X |

---

## 🚀 快速启动

### 最简单方案：WSL2

```bash
cd /mnt/d/大三上课程/恶意代码/实验报告/大作业/YARA-X\ Manager/YARA-X\ Manager/
bash run.sh
```

### Windows 方案（需要先安装 Redis）

```powershell
# 1. 安装 Redis (选择一个)
# - Memurai: https://www.memurai.com/
# - Chocolatey: choco install redis-64

# 2. 运行启动脚本
.\start.ps1
```

---

## 📊 项目核心对比

### BinaryAlert vs YARA-X Manager

| 维度 | BinaryAlert | YARA-X Manager |
|------|------------|----------------|
| **部署位置** | AWS 云平台 | 任意服务器 |
| **架构模式** | Serverless | Web 服务 + 任务队列 |
| **适用规模** | PB 级 | GB/TB 级 |
| **成本模型** | 按需付费 | 固定成本 |
| **学习门槛** | 高（AWS 知识） | 低（Python Web） |
| **典型场景** | 企业生产环境 | 教学/实验/中小规模 |

---

## 🎯 核心功能

### 1. 样本管理
```bash
# 上传样本
curl -X POST http://localhost:8000/samples/upload -F "files=@sample.exe"

# 查看所有样本
curl http://localhost:8000/samples/
```

### 2. 规则管理
```bash
# 上传规则
curl -X POST http://localhost:8000/rules/upload -F "files=@rule.yar"

# 查看所有规则
curl http://localhost:8000/rules/
```

### 3. 扫描任务
```bash
# 启动扫描
curl -X POST http://localhost:8000/scans/start

# 查看扫描结果
curl http://localhost:8000/scans/{filename}/results
```

---

## 🔧 技术栈

### YARA-X Manager
```
FastAPI (Web 框架)
  ↓
Celery (任务队列)
  ↓
Redis (消息代理)
  ↓
YARA-X (扫描引擎)
  ↓
SQLite (数据库)
```

### BinaryAlert
```
S3 (存储)
  ↓
SQS (消息队列)
  ↓
Lambda (计算)
  ↓
YARA (扫描引擎)
  ↓
DynamoDB (数据库)
```

---

## 💡 核心创新点

1. **YARA-X 引擎**
   - 更快（Rust 实现）
   - 更易部署（预编译二进制）

2. **SSE 实时推送**
   - 无需轮询
   - 更好体验

3. **Web API 管理**
   - 规则实时验证
   - 易于集成前端

4. **一键部署**
   - 简化安装流程
   - 适合教学环境

---

## 📈 改进方向

### 短期（1-3 月）
- [ ] Web 前端界面
- [ ] 用户认证与权限
- [ ] 压缩包扫描支持
- [ ] 告警通知集成

### 中期（3-6 月）
- [ ] 分布式扫描
- [ ] 对象存储支持
- [ ] 追溯扫描优化
- [ ] 性能监控

### 长期（6-12 月）
- [ ] Kubernetes 部署
- [ ] 机器学习集成
- [ ] 插件化架构

---

## 🎓 学习价值

### 技术层面
- Serverless vs Traditional 架构
- YARA 规则引擎使用
- 异步任务队列设计
- RESTful API 最佳实践

### 工程层面
- 系统架构对比分析
- 开源项目研究方法
- 跨平台开发经验
- 自动化部署脚本

---

## 📞 API 接口速查

### Swagger 文档
```
http://localhost:8000/docs
```

### 主要端点
```
GET  /                           # 健康检查
GET  /samples/                   # 列出所有样本
POST /samples/upload             # 上传样本
GET  /rules/                     # 列出所有规则
POST /rules/upload               # 上传规则
POST /rules/delete/{ids}         # 删除规则
POST /scans/start                # 启动扫描
GET  /scans/status               # 扫描状态（SSE）
GET  /scans/{name}/results       # 查询结果
```

---

## 🐛 常见问题

### Q1: Redis 连接失败
```bash
# 检查 Redis 是否运行
# Docker
docker ps | Select-String redis

# 本地安装
Get-Process redis-server
```

### Q2: Celery 无法启动
```bash
# Windows 需要使用 solo pool
celery -A app.celery_app.cel worker --loglevel=info --pool=solo
```

### Q3: 端口被占用
```bash
# 修改 run.ps1 中的端口号
# 或关闭占用 8000 端口的进程
Get-Process -Id (Get-NetTCPConnection -LocalPort 8000).OwningProcess | Stop-Process
```

---

## 📁 项目结构速查

```
YARA-X Manager/
├── app/                    # 应用代码
│   ├── main.py            # 应用入口
│   ├── celery_app.py      # Celery 配置
│   ├── tasks.py           # 异步任务
│   ├── yara_interface.py  # YARA-X 封装
│   └── api/               # API 路由
│       ├── samples.py
│       ├── rules.py
│       └── scans.py
├── data/                  # 数据存储
│   ├── cache/            # 样本缓存
│   └── rules/            # 规则文件
├── run.sh                # Linux 启动脚本
├── run.ps1               # Windows 启动脚本
└── 实验报告.md           # 完整实验报告
```

---

## 🔗 相关链接

- **YARA-X GitHub**: https://github.com/VirusTotal/yara-x
- **BinaryAlert GitHub**: https://github.com/airbnb/binaryalert
- **FastAPI 文档**: https://fastapi.tiangolo.com/
- **Celery 文档**: https://docs.celeryproject.org/

---

## ✅ 完成检查清单

- [x] 分析 run.sh 启动流程
- [x] 创建 Windows 启动脚本
- [x] 研究 BinaryAlert 架构
- [x] 对比两个项目差异
- [x] 完善实验报告
- [x] 编写使用文档
- [x] 梳理核心功能
- [x] 提出改进建议

---

**最后更新**: 2025年11月15日  
**项目版本**: YARA-X Manager v0.1  
**文档版本**: 1.0
